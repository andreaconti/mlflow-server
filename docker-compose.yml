version: "3.9"
services:

  # main mlflow server
  server:
    build: ./mlflow
    ports:
      - "0.0.0.0:6006:5000"
    environment:
      - STORE_URI=mysql://mlflow:mlflow@backend-store:3306/mlflow
    links:
      - backend-store
    volumes:
      - artifacts:/artifacts
    command: --host 0.0.0.0 --backend-store-uri mysql://mlflow:mlflow@backend-store:3306/mlflow --serve-artifacts --artifacts-destination /artifacts
  
  # MySQL database
  backend-store:
    image: mysql:8.0.29-debian
    environment:
      - MYSQL_ROOT_PASSWORD=mlflow-server-pwd
      - MYSQL_USER=mlflow
      - MYSQL_PASSWORD=mlflow
      - MYSQL_DATABASE=mlflow
    volumes:
      - db:/val/lib/mysql

volumes:
  db:
  artifacts:
